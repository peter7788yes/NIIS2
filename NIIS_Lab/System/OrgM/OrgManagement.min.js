/*! NIIS 2016-05-09 */

angular.module("MyApp",["TreeM"]).controller("MyController",["$scope","$http",function(a,b){a.VM={},a.VM.selectedItemParent="",a.VM.selectedItem={selectedItem:0},a.VM.dataItem={I:0,AC:"",N:"",EN:"",SN:"",OL:0,AS:0,ON:0},a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}],a.VM.tmpSelectedItemParent="",a.VM.tmpSelectedItem={selectedItem:0},a.VM.tmpDataItem={I:0,AC:"",N:"",EN:"",SN:"",OL:0,AS:0,ON:0},a.VM.tmpDataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}],a.getIpPart=function(){0==a.VM.dataItem.IP.length?a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}]:angular.forEach(a.VM.dataItem.IP,function(a,b){a.IS=a.IS||"0.0.0.0",a.IE=a.IE||"0.0.0.0";var c=a.IS.split("."),d=a.IE.split(".");a.i1=parseInt(c[0]),a.i2=parseInt(c[1]),a.i3=parseInt(c[2]),a.i4=parseInt(c[3]),a.i5=parseInt(d[0]),a.i6=parseInt(d[1]),a.i7=parseInt(d[2]),a.i8=parseInt(d[3]),a.IS=a.i1+"."+a.i2+"."+a.i3+"."+a.i4,a.IE=a.i5+"."+a.i6+"."+a.i7+"."+a.i8}),a.VM.tmpDataItem.IP=a.VM.dataItem.IP},a.getIpString=function(){0==a.VM.dataItem.IP.length?a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}]:angular.forEach(a.VM.dataItem.IP,function(a,b){a.i1=a.i1||0,a.i2=a.i2||0,a.i3=a.i3||0,a.i4=a.i4||0,a.i5=a.i5||0,a.i6=a.i6||0,a.i7=a.i7||0,a.i8=a.i8||0,a.IS=a.i1+"."+a.i2+"."+a.i3+"."+a.i4,a.IE=a.i5+"."+a.i6+"."+a.i7+"."+a.i8}),a.VM.tmpDataItem.IP=a.VM.dataItem.IP};var c=sessionStorage.getItem("OrgManagementOrigin");if(c==data){var d=sessionStorage.getItem("OrgManagement");a.VM.tree=JSON.parse(d)}else{var e={},f=[];$.each(JSON.parse(data),function(a,b){b.children=b.children||[],0==b.P?(f.push(b),e=b):null!=e&&(e.I==b.P?e.children.push(b):GenMenuRecursive(b,e))}),a.VM.tree=f,sessionStorage.setItem("OrgManagementOrigin",data),sessionStorage.setItem("OrgManagement",JSON.stringify(f))}a.getDetail=function(c){var d={};d.i=c.I,b({method:"POST",url:"/System/OrgM/OrgManagementOP.aspx",data:$.param(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){a.VM.dataItem=b,a.VM.tmpDataItem=b,a.getIpPart()}).error(function(a,b,c,d){})},a.goSave=function(){var c={};c.i=a.VM.selectedItem.I,c.ac=a.VM.dataItem.AC,c.n=a.VM.dataItem.N,c.en=a.VM.dataItem.EN,c.sn=a.VM.dataItem.SN,c.ol=a.VM.dataItem.OL,c.as=a.VM.dataItem.AS,c.on=a.VM.dataItem.ON,a.getIpString();var d=[];$.each(a.VM.dataItem.IP,function(a,b){var c=_.pick(b,["IS","IE"]);d.push(c)}),c.ips=encodeURIComponent(JSON.stringify(d));var e="/System/OrgM/OrgManagement_UpdateOP.aspx";2==a.VM.selectedItem.hightLight&&(e="/System/OrgM/OrgManagement_AddOP.aspx"),b({method:"POST",url:e,data:$.param(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){if(b.chk>0){if(2==a.VM.selectedItem.hightLight){var f={};f.I=parseInt(b.message),f.O=a.VM.dataItem.N,f.children=[],f.sort=a.VM.dataItem.ON,f.P=a.VM.selectedItem.I,a.goLast(),a.VM.selectedItem.children.push(f),a.VM.selectedItem.I>0&&(GetParentRecursive(a.VM.selectedItem.I),node.children=_.sortBy(node.children,["sort","I"]))}else{GetParentRecursive(a.VM.dataItem.I),node.O=a.VM.dataItem.N,node.sort=a.VM.dataItem.ON;a.VM.selectedItem.P>0&&(GetParentRecursive(a.VM.selectedItem.P),node.children=_.sortBy(node.children,["sort","I"]))}a.VM.selectedItem.hightLight=1,alert("儲存成功")}else alert("儲存失敗")}).error(function(a,b,c,d){})},a.VM.itemClicked=function(b){a.goSelectElement(),b.hightLight=1,a.VM.selectedItem=b,a.getDetail(b),a.VM.selectedItemParent="",GetParentRecursive(b.P),a.VM.selectedItemParent=nodeName,a.VM.tmpSelectedItem=b,a.VM.tmpSelectedItemParent=nodeName},a.VM.itemCheckedChanged=function(a){},a.addIP=function(){a.VM.dataItem.IP.push({IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0})},a.cutIP=function(b){a.VM.dataItem.IP.splice(b,1)},a.goSelectElement=function(){$("#saveBtn").show("slow"),$("#addBtn").show("slow"),$("#deleteBtn").show("slow"),$("#lastBtn").hide("slow")},a.goAdd=function(){a.VM.tmpDataItem=a.VM.dataItem,a.VM.tmpDataItem.IP=a.VM.dataItem.IP,a.VM.dataItem={I:0,AC:"",N:"",EN:"",SN:"",OL:0,AS:0,ON:0},a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}],a.VM.selectedItemParent=a.VM.selectedItem.O,a.VM.selectedItem={hightLight:2,I:a.VM.selectedItem.I,AC:"",N:"",EN:"",SN:"",OL:0,AS:0,ON:0},$("#saveBtn").show("slow"),$("#addBtn").hide("slow"),$("#deleteBtn").hide("slow"),$("#lastBtn").show("slow"),window.refreshMenuPath(function(){$(".path").html('<span class="pathReplaceA">系統管理</span><span class="pathReplaceA">組織管理</span>新增<img id="loading" src="/images/loading001.gif" style="display:none;margin-left:5px;">')})},a.goDelete=function(){var c={};c.i=a.VM.selectedItem.I,b({method:"POST",url:"/System/OrgM/OrgManagement_RemoveOP.aspx",data:$.param(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){if(b.chk>0){a.VM.selectedItem.P>0&&(GetParentRecursive(a.VM.selectedItem.P),_.remove(node.children,function(b){return b.I==a.VM.selectedItem.I})),$("#saveBtn").hide("slow"),$("#addBtn").hide("slow"),$("#deleteBtn").hide("slow"),$("#lastBtn").hide("slow"),alert("儲存成功")}else alert("儲存失敗")}).error(function(a,b,c,d){})},a.goLast=function(){a.VM.selectedItem=a.VM.tmpSelectedItem,a.VM.selectedItem.hightLight=1,a.VM.selectedItemParent=a.VM.tmpSelectedItemParent,a.VM.dataItem=a.VM.tmpDataItem,a.VM.dataItem.IP=a.VM.tmpDataItem.IP,$("#saveBtn").show("slow"),$("#addBtn").show("slow"),$("#deleteBtn").show("slow"),$("#lastBtn").hide("slow"),window.refreshMenuPath(function(){$(".path").html(' <span class="pathReplaceA">系統管理</span>組織管理<img id="loading" src="/images/loading001.gif" style="display:none;margin-left:5px;">')})}}]);var node={},nodeName="",GetParentRecursive=function(a){nodeName="";var b=document.querySelector("section"),c=angular.element(b).scope();RecursiveObj(c.VM.tree[0],a)},RecursiveObj=function(a,b){a.I==b?(nodeName=a.O,node=a):(a.children=a.children||[],$.each(a.children,function(a,c){RecursiveObj(c,b)}))},GenMenuRecursive=function(a,b){var c;b.children=b.children||[];for(var d=0;d<=b.children.length-1;d++)a.P==b.children[d].I&&(c=b.children[d]);null!=c?(c.children=c.children||[],c.children.push(a)):b.children.forEach(function(b){GenMenuRecursive(a,b)})};
//# sourceMappingURL=OrgManagement.min.js.map