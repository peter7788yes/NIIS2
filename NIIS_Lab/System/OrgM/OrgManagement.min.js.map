{"version":3,"sources":["OrgManagement.src.js"],"names":["angular","module","controller","$scope","$http","VM","selectedItemParent","selectedItem","dataItem","I","AC","N","EN","SN","OL","AS","ON","IP","IS","IE","i1","i2","i3","i4","i5","i6","i7","i8","tmpSelectedItemParent","tmpSelectedItem","tmpDataItem","getIpPart","length","forEach","item","index","ISA","split","IEA","parseInt","getIpString","OrgsMenuOrigin","sessionStorage","getItem","data","finalObj","tree","JSON","parse","lastNode","rtn","$","each","children","P","push","GenMenuRecursive","setItem","stringify","getDetail","$item","postData","method","url","param","headers","Content-Type","success","status","config","error","goSave","IPs","obj","_","pick","encodeURIComponent","hightLight","chk","newItem","message","O","sort","goLast","GetParentRecursive","node","sortBy","alert","itemClicked","goSelectElement","nodeName","itemCheckedChanged","addIP","cutIP","$index","splice","show","hide","goAdd","window","refreshMenuPath","html","goDelete","remove","id","controllerElement","document","querySelector","controllerScope","element","scope","RecursiveObj","nowNode","innerNode","myParent","i"],"mappings":"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","file":"OrgManagement.min.js","sourcesContent":["angular.module(\"MyApp\", [\"TreeM\"])\r\n         .controller(\"MyController\", [\"$scope\", \"$http\", function ($scope, $http) {\r\n\r\n          $scope.VM = {};\r\n          $scope.VM.selectedItemParent = \"\";\r\n          $scope.VM.selectedItem = { selectedItem: 0 };\r\n         \r\n          $scope.VM.dataItem = { I: 0, AC: \"\", N: \"\", EN: \"\", SN: \"\", OL: 0, AS: 0, ON: 0 };\r\n          $scope.VM.dataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n\r\n          $scope.VM.tmpSelectedItemParent = \"\";\r\n          $scope.VM.tmpSelectedItem = { selectedItem: 0 };\r\n          $scope.VM.tmpDataItem = { I: 0, AC: \"\", N: \"\", EN: \"\", SN: \"\", OL: 0, AS: 0, ON: 0 };\r\n          $scope.VM.tmpDataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n\r\n          $scope.getIpPart = function () {\r\n\r\n              if ($scope.VM.dataItem.IP.length == 0) {\r\n                  $scope.VM.dataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n              }\r\n              else {\r\n                  angular.forEach($scope.VM.dataItem.IP, function (item, index) {\r\n                      item.IS = item.IS || \"0.0.0.0\";\r\n                      item.IE = item.IE || \"0.0.0.0\";\r\n\r\n                      var ISA = item.IS.split('.');\r\n                      var IEA = item.IE.split('.');\r\n\r\n                      item.i1 = parseInt(ISA[0]);\r\n                      item.i2 = parseInt(ISA[1]);\r\n                      item.i3 = parseInt(ISA[2]);\r\n                      item.i4 = parseInt(ISA[3]);\r\n\r\n                      item.i5 = parseInt(IEA[0]);\r\n                      item.i6 = parseInt(IEA[1]);\r\n                      item.i7 = parseInt(IEA[2]);\r\n                      item.i8 = parseInt(IEA[3]);\r\n\r\n                      item.IS = item.i1 + '.' + item.i2 + '.' + item.i3 + '.' + item.i4;\r\n                      item.IE = item.i5 + '.' + item.i6 + '.' + item.i7 + '.' + item.i8;\r\n\r\n                  });\r\n              }\r\n\r\n              $scope.VM.tmpDataItem.IP = $scope.VM.dataItem.IP\r\n          };\r\n\r\n          $scope.getIpString = function () {\r\n              if ($scope.VM.dataItem.IP.length == 0) {\r\n                  $scope.VM.dataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n              }\r\n              else {\r\n                  angular.forEach($scope.VM.dataItem.IP, function (item, index) {\r\n\r\n                      item.i1 = item.i1 || 0;\r\n                      item.i2 = item.i2 || 0;\r\n                      item.i3 = item.i3 || 0;\r\n                      item.i4 = item.i4 || 0;\r\n                      item.i5 = item.i5 || 0;\r\n                      item.i6 = item.i6 || 0;\r\n                      item.i7 = item.i7 || 0;\r\n                      item.i8 = item.i8 || 0;\r\n\r\n                      item.IS = item.i1 + '.' + item.i2 + '.' + item.i3 + '.' + item.i4;\r\n                      item.IE = item.i5 + '.' + item.i6 + '.' + item.i7 + '.' + item.i8;\r\n                  });\r\n              }\r\n\r\n              $scope.VM.tmpDataItem.IP = $scope.VM.dataItem.IP\r\n\r\n          };\r\n\r\n          var OrgsMenuOrigin = sessionStorage.getItem(\"OrgManagementOrigin\");\r\n          if (OrgsMenuOrigin == data) {\r\n              var finalObj = sessionStorage.getItem(\"OrgManagement\");\r\n              $scope.VM.tree = JSON.parse(finalObj);\r\n          }\r\n          else {\r\n              var lastNode = {};\r\n              var rtn = [];\r\n\r\n              $.each(JSON.parse(data), function (index, item) {\r\n                  item.children = item.children || [];\r\n                  if (item.P == 0) {\r\n                      rtn.push(item);\r\n                      lastNode = item;\r\n                  }\r\n                  else {\r\n                      if (lastNode != null) {\r\n                          if (lastNode.I == item.P) {\r\n                              lastNode.children.push(item);\r\n                          }\r\n                          else {\r\n                              GenMenuRecursive(item, lastNode);\r\n                          }\r\n                      }\r\n                  }\r\n              });\r\n              $scope.VM.tree = rtn;\r\n\r\n              sessionStorage.setItem(\"OrgManagementOrigin\", data);\r\n              sessionStorage.setItem(\"OrgManagement\", JSON.stringify(rtn));\r\n          }\r\n\r\n          $scope.getDetail = function ($item) {\r\n              \r\n              var postData = {};\r\n              postData[\"i\"] = $item.I;\r\n\r\n              $http({\r\n                  method: 'POST',\r\n                  url: \"/System/OrgM/OrgManagementOP.aspx\",\r\n                  data: $.param(postData),\r\n                  headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n              })\r\n             .success(function (data, status, headers, config) {\r\n                 //console.log(JSON.stringify(data));\r\n                 $scope.VM.dataItem = data;\r\n                 $scope.VM.tmpDataItem = data;\r\n                 //$scope.VM.dataItem.IP = data.IP || [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n                 //console.log($scope.VM.dataItem.IP);\r\n                 $scope.getIpPart();\r\n              })\r\n              .error(function (data, status, headers, config) {\r\n              });\r\n          };\r\n\r\n          $scope.goSave = function () {\r\n              //if($scope.VM.dataItem.I>0)\r\n              //{\r\n                  var postData = {};\r\n                  postData[\"i\"] = $scope.VM.selectedItem.I;\r\n                  postData[\"ac\"] = $scope.VM.dataItem.AC;\r\n                  postData[\"n\"] = $scope.VM.dataItem.N;\r\n                  postData[\"en\"] = $scope.VM.dataItem.EN;\r\n                  postData[\"sn\"] = $scope.VM.dataItem.SN;\r\n                  postData[\"ol\"] = $scope.VM.dataItem.OL;\r\n                  postData[\"as\"] = $scope.VM.dataItem.AS;\r\n                  postData[\"on\"] = $scope.VM.dataItem.ON;\r\n\r\n                  $scope.getIpString();\r\n                  var IPs = [];\r\n                  $.each($scope.VM.dataItem.IP, function (index, item) {\r\n                      var obj = _.pick(item, ['IS', \"IE\"]);\r\n                      IPs.push(obj);\r\n                      //console.log(IPs);\r\n                  });\r\n                  postData[\"ips\"] = encodeURIComponent(JSON.stringify(IPs));\r\n\r\n                  var url =  \"/System/OrgM/OrgManagement_UpdateOP.aspx\";\r\n                  if ($scope.VM.selectedItem.hightLight == 2)\r\n                      url = \"/System/OrgM/OrgManagement_AddOP.aspx\";\r\n\r\n                  $http({\r\n                      method: 'POST',\r\n                      url: url,\r\n                      data: $.param(postData),\r\n                      headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                  })\r\n                 .success(function (data, status, headers, config) {\r\n                     if (data.chk > 0) {\r\n                          \r\n\r\n                             if ($scope.VM.selectedItem.hightLight == 2) {\r\n                                 var newItem = {};\r\n                                 newItem.I = parseInt(data.message);\r\n                                 newItem.O = $scope.VM.dataItem.N;\r\n                                 newItem.children = [];\r\n                                 newItem.sort = $scope.VM.dataItem.ON;\r\n                                 newItem.P = $scope.VM.selectedItem.I;\r\n                                 $scope.goLast();\r\n                                 $scope.VM.selectedItem.children.push(newItem);\r\n\r\n                                 if ($scope.VM.selectedItem.I > 0) { \r\n                                     GetParentRecursive($scope.VM.selectedItem.I);\r\n                                     node.children = _.sortBy(node.children, [\"sort\", \"I\"]);\r\n                                 }\r\n\r\n                             }\r\n                             else {\r\n                                 GetParentRecursive($scope.VM.dataItem.I);\r\n                                 node.O = $scope.VM.dataItem.N;\r\n                                 //console.log($scope.VM.dataItem.ON)\r\n                                 node.sort = $scope.VM.dataItem.ON;\r\n                                 var myitem = {};\r\n                                 var IDAry = [];\r\n                                 if ($scope.VM.selectedItem.P > 0) {\r\n                                     GetParentRecursive($scope.VM.selectedItem.P);\r\n                                     node.children = _.sortBy(node.children, [\"sort\", \"I\"]);\r\n                                }\r\n\r\n                            \r\n                                 //var rootTree=$scope.VM.tree;\r\n                                 //var hasFound = false;\r\n                                 //while (hasFound == false) {\r\n                                 //    $.each(rootTree, function (index, item) {\r\n                                 //        if (item.I == $scope.VM.selectedItem.P) {\r\n                                 //            hasFound = true;\r\n                                 //            item.children = _.sortBy(item.children, [\"sort\", \"I\"]);\r\n                                 //            //console.log(item.children);\r\n                                 //        }\r\n                                 //    });\r\n\r\n                                 //    if(hasFound == false)\r\n                                 //    {\r\n                                 //        rootTree\r\n                                 //    }\r\n                                 //}\r\n                                 //myitem = _.filter($scope.VM.tree, function (item) {\r\n                                 //    if (item.I == $scope.VM.selectedItem.P)\r\n                                 //        return item;\r\n                                 //});\r\n                                 //_.forEach($scope.VM.tree, function (value, key) {\r\n                                 //    console.log(key);\r\n                                 //});\r\n                             }\r\n                             $scope.VM.selectedItem.hightLight = 1;\r\n                             alert('儲存成功');\r\n                     }\r\n                     else {\r\n                         alert('儲存失敗');\r\n                     }\r\n                 })\r\n                  .error(function (data, status, headers, config) {\r\n                  });\r\n              //}\r\n              //else\r\n              //{\r\n              //    alert(\"請選擇組織單位\");\r\n              //}\r\n          };\r\n\r\n\r\n\r\n          $scope.VM.itemClicked = function ($item) {\r\n              $scope.goSelectElement();\r\n              $item.hightLight=1;\r\n              $scope.VM.selectedItem = $item;\r\n             \r\n              $scope.getDetail($item);\r\n              $scope.VM.selectedItemParent = \"\";\r\n              GetParentRecursive($item.P);\r\n              $scope.VM.selectedItemParent = nodeName;\r\n              //console.log($scope.VM.selectedItem);\r\n\r\n              $scope.VM.tmpSelectedItem = $item;\r\n              $scope.VM.tmpSelectedItemParent = nodeName;\r\n\r\n          };\r\n\r\n          $scope.VM.itemCheckedChanged = function ($item) {\r\n          };\r\n\r\n          $scope.addIP = function () {\r\n              $scope.VM.dataItem.IP.push({ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 });\r\n              //$(\".icon_no\").show();\r\n          };\r\n\r\n          $scope.cutIP = function ($index) {\r\n              $scope.VM.dataItem.IP.splice($index, 1);\r\n              //_.pullAt($scope.VM.dataItem.IP, $index);\r\n              //if ($scope.VM.dataItem.IP.length == 1)\r\n              //{\r\n              //    $(\".icon_no\").hide();\r\n              //}\r\n          };\r\n           \r\n          $scope.goSelectElement = function () {\r\n              $('#saveBtn').show('slow');\r\n              $('#addBtn').show('slow');\r\n              $('#deleteBtn').show('slow');\r\n              $('#lastBtn').hide('slow');\r\n          };\r\n\r\n          $scope.goAdd = function () {\r\n\r\n              $scope.VM.tmpDataItem = $scope.VM.dataItem;\r\n              $scope.VM.tmpDataItem.IP = $scope.VM.dataItem.IP;\r\n              $scope.VM.dataItem = { I: 0, AC: \"\", N: \"\", EN: \"\", SN: \"\", OL: 0, AS: 0, ON: 0 };\r\n              $scope.VM.dataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n              $scope.VM.selectedItemParent = $scope.VM.selectedItem.O;\r\n              $scope.VM.selectedItem = { hightLight: 2, I: $scope.VM.selectedItem.I, AC: \"\", N: \"\", EN: \"\", SN: \"\", OL: 0, AS: 0, ON: 0 };\r\n\r\n              $('#saveBtn').show('slow');\r\n              $('#addBtn').hide('slow');\r\n              $('#deleteBtn').hide('slow');\r\n              $('#lastBtn').show('slow');\r\n              window.refreshMenuPath(function () {\r\n                  $('.path').html('<span class=\"pathReplaceA\">系統管理</span><span class=\"pathReplaceA\">組織管理</span>新增<img id=\"loading\" src=\"/images/loading001.gif\" style=\"display:none;margin-left:5px;\">');\r\n              });\r\n          };\r\n\r\n          $scope.goDelete = function () {\r\n              var postData = {};\r\n              postData[\"i\"] = $scope.VM.selectedItem.I;\r\n\r\n              $http({\r\n                  method: 'POST',\r\n                  url: \"/System/OrgM/OrgManagement_RemoveOP.aspx\",\r\n                  data: $.param(postData),\r\n                  headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n              })\r\n             .success(function (data, status, headers, config) {\r\n                 if (data.chk > 0) {\r\n\r\n                     var myitem = {};\r\n                     var IDAry = [];\r\n                     if ($scope.VM.selectedItem.P > 0) {\r\n                         GetParentRecursive($scope.VM.selectedItem.P);\r\n                         _.remove(node.children, function (item) {\r\n                             return item.I == $scope.VM.selectedItem.I;\r\n                         });\r\n                         \r\n                     }\r\n\r\n                     $('#saveBtn').hide('slow');\r\n                     $('#addBtn').hide('slow');\r\n                     $('#deleteBtn').hide('slow');\r\n                     $('#lastBtn').hide('slow');\r\n\r\n                     alert('儲存成功');\r\n                 }\r\n                 else {\r\n                     alert('儲存失敗');\r\n                 }\r\n              })\r\n              .error(function (data, status, headers, config) {\r\n              });\r\n          };\r\n\r\n          $scope.goLast = function () {\r\n\r\n              $scope.VM.selectedItem = $scope.VM.tmpSelectedItem;\r\n              $scope.VM.selectedItem.hightLight = 1;\r\n              $scope.VM.selectedItemParent = $scope.VM.tmpSelectedItemParent;\r\n              $scope.VM.dataItem = $scope.VM.tmpDataItem;\r\n              $scope.VM.dataItem.IP = $scope.VM.tmpDataItem.IP;\r\n\r\n              $('#saveBtn').show('slow');\r\n              $('#addBtn').show('slow');\r\n              $('#deleteBtn').show('slow');\r\n              $('#lastBtn').hide('slow');\r\n              window.refreshMenuPath(function () {\r\n                  $('.path').html(' <span class=\"pathReplaceA\">系統管理</span>組織管理<img id=\"loading\" src=\"/images/loading001.gif\" style=\"display:none;margin-left:5px;\">');\r\n              });\r\n\r\n              \r\n          };\r\n}]);\r\n\r\nvar node = {};\r\nvar nodeName = \"\";\r\nvar GetParentRecursive = function (id) {\r\n    nodeName = \"\";\r\n    var controllerElement = document.querySelector('section');\r\n    var controllerScope = angular.element(controllerElement).scope();\r\n    RecursiveObj(controllerScope.VM.tree[0], id);\r\n};\r\n\r\nvar RecursiveObj = function (obj, id) {\r\n    \r\n    if (obj.I == id) {\r\n        nodeName = obj.O;\r\n        node = obj;\r\n    }\r\n    else {\r\n        obj.children = obj.children || [];\r\n        $.each(obj.children, function (index, item) {\r\n            RecursiveObj(item, id);\r\n        });\r\n    }\r\n}\r\n\r\nvar GenMenuRecursive = function (nowNode, innerNode) {\r\n    var myParent;\r\n    innerNode.children = innerNode.children || [];\r\n\r\n    for (var i = 0; i <= innerNode.children.length - 1 ; i++) {\r\n        if (nowNode.P == innerNode.children[i].I) {\r\n            myParent = innerNode.children[i];\r\n        }\r\n    }\r\n\r\n    if (myParent != null) {\r\n        myParent.children = myParent.children || [];\r\n        myParent.children.push(nowNode);\r\n    }\r\n    else {\r\n        innerNode.children.forEach(function (item) {\r\n            GenMenuRecursive(nowNode, item);\r\n        });\r\n    }\r\n}\r\n"]}