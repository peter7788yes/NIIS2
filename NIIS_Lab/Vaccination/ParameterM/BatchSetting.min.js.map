{"version":3,"sources":["BatchSetting.src.js"],"names":["$","document","on","e","location","href","preventDefault","onSelectSingleOrg","controllerElement","querySelector","controllerScope","angular","element","scope","$apply","changeVaccine","module","controller","$scope","TPM","$http","VM","locationObj","text","id","VaccineSelect","selectCheck","TM","tbData1","tbData2","postData","window","getOrgID","method","url","data","param","headers","Content-Type","success","status","config","list1","length","I","show","hide","list2","forEach","value","key","DBVID","push","error","changeSelect","goSetting","record","console","log","VBID","chk","alert","splice","goRemove"],"mappings":";;AAAAA,EAAE,WACEA,EAAEC,UAAUC,GAAG,QAAS,UAAW,SAAUC,GAGzC,MAFAC,UAASC,KAAO,6CAChBF,EAAEG,kBACK,KAIf,IAAIC,mBAAoB,WACpB,GAAIC,GAAoBP,SAASQ,cAAc,WAC3CC,EAAkBC,QAAQC,QAAQJ,GAAmBK,OACzDH,GAAgBI,OAAO,WACnBJ,EAAgBK,kBAIxBJ,SAAQK,OAAO,SAAU,UAAU,UAazBC,WAAW,gBAAiB,SAAS,eAAgB,QAAS,SAAUC,EAAOC,EAAKC,GAEjFF,EAAOG,MACPH,EAAOG,GAAGC,eACVJ,EAAOG,GAAGC,YAAYC,KAAO,GAC7BL,EAAOG,GAAGC,YAAYE,GAAM,EAC5BN,EAAOG,GAAGI,iBACVP,EAAOG,GAAGK,YAAc,IACxBR,EAAOS,MACPT,EAAOS,GAAGC,WACVV,EAAOS,GAAGE,WAEVX,EAAOH,cAAgB,WACnB,GAAIe,KAEJA,GAAY,EAAIC,OAAOC,WAEvBZ,GACIa,OAAQ,OACRC,IAAK,sDACLC,KAAMnC,EAAEoC,MAAMN,GACdO,SAAWC,eAAgB,uCAE9BC,QAAQ,SAAUJ,EAAMK,EAAQH,EAASI,GACtBN,EAAKO,MAAQP,EAAKO,UACdP,EAAKO,MAAMC,OAAS,GACnBzB,EAAOG,GAAGI,cAAgBU,EAAKO,MAC/BxB,EAAOG,GAAGK,YAAcS,EAAKO,MAAM,GAAGE,EACtC5C,EAAE,OAAO6C,SAGT3B,EAAOG,GAAGI,iBACVP,EAAOG,GAAGK,YAAc,IACxBR,EAAOS,GAAGC,WACV5B,EAAE,OAAO8C,QAGd5B,EAAOS,GAAGC,WACVV,EAAOS,GAAGE,WAEVX,EAAOS,GAAGC,QAAUO,EAAKY,MAEzBpC,QAAQqC,QAAQ9B,EAAOS,GAAGC,QAAS,SAAUqB,EAAOC,GAC7CD,EAAME,MAAM,GAEXjC,EAAOS,GAAGE,QAAQuB,KAAKH,OAIjDI,MAAM,SAAUlB,EAAMK,EAAQH,EAASI,OAI7CvB,EAAOoC,aAAe,WAClBpC,EAAOG,GAAGK,YAAcR,EAAOG,GAAGK,aAAe,CACjD,IAAII,KACJA,GAAY,EAAIZ,EAAOG,GAAGK,YAE1BN,GACIa,OAAQ,OACRC,IAAK,sEACLC,KAAMnC,EAAEoC,MAAMN,GACdO,SAAWC,eAAgB,uCAE9BC,QAAQ,SAAUJ,EAAMK,EAAQH,EAASI,GACtCvB,EAAOS,GAAGC,QAAUO,IAEvBkB,MAAM,SAAUlB,EAAMK,EAAQH,EAASI,OAI5CvB,EAAOqC,UAAY,SAAUC,GAEzB,GADAC,QAAQC,IAAIF,GACQ,GAAhBA,EAAOL,MAAY,CAEnB,GAAIrB,KACJA,GAAY,EAAI0B,EAAOG,KACvB7B,EAAY,EAAI0B,EAAOZ,EAEvBxB,GACIa,OAAQ,OACRC,IAAK,kDACLC,KAAMnC,EAAEoC,MAAMN,GACdO,SAAWC,eAAgB,uCAE/BC,QAAQ,SAAUJ,EAAMK,EAAQH,EAASI,GACtCN,EAAKyB,IAAMzB,EAAKyB,KAAO,EACnBzB,EAAKyB,IAAM,GACXJ,EAAOL,MAAQhB,EAAKyB,IACpB1C,EAAOS,GAAGE,QAAQuB,KAAKI,IAIvBK,MAAM,UAGbR,MAAM,SAAUlB,EAAMK,EAAQH,EAASI,UAI3C,CACI,GAAIX,KACJA,GAAY,EAAI0B,EAAOL,MAEvB/B,GACIa,OAAQ,OACRC,IAAK,qDACLC,KAAMnC,EAAEoC,MAAMN,GACdO,SAAWC,eAAgB,uCAE/BC,QAAQ,SAAUJ,EAAMK,EAAQH,EAASI,GACtCN,EAAKyB,IAAMzB,EAAKyB,KAAO,EACnBzB,EAAKyB,IAAM,GACXjD,QAAQqC,QAAQ9B,EAAOS,GAAGE,QAAS,SAAUoB,EAAOC,GAC5CD,EAAME,OAASK,EAAOL,OACtBjC,EAAOS,GAAGE,QAAQiC,OAAOZ,EAAK,KAGtCM,EAAOL,MAAQ,GAIfU,MAAM,UAGbR,MAAM,SAAUlB,EAAMK,EAAQH,EAASI,QAS/CvB,EAAO6C,SAAW,SAAUP,GAEpB,GAAI1B,KACJA,GAAY,EAAI0B,EAAOL,MAEvB/B,GACIa,OAAQ,OACRC,IAAK,qDACLC,KAAMnC,EAAEoC,MAAMN,GACdO,SAAWC,eAAgB,uCAE/BC,QAAQ,SAAUJ,EAAMK,EAAQH,EAASI,GACtCN,EAAKyB,IAAMzB,EAAKyB,KAAO,EACnBzB,EAAKyB,IAAM,GACXjD,QAAQqC,QAAQ9B,EAAOS,GAAGE,QAAS,SAAUoB,EAAOC,GAC5CD,EAAME,OAASK,EAAOL,OACtBjC,EAAOS,GAAGE,QAAQiC,OAAOZ,EAAK,KAGtCM,EAAOL,MAAQ,GAIfU,MAAM,UAGbR,MAAM,SAAUlB,EAAMK,EAAQH,EAASI","file":"BatchSetting.min.js","sourcesContent":["$(function () {\r\n    $(document).on(\"click\", \"#addBtn\", function (e) {\r\n        location.href = \"/Vaccination/RecordM/RegisterData_Add.aspx\";\r\n        e.preventDefault();\r\n        return false;\r\n    });\r\n});\r\n\r\nvar onSelectSingleOrg = function () {\r\n    var controllerElement = document.querySelector('section');\r\n    var controllerScope = angular.element(controllerElement).scope();\r\n    controllerScope.$apply(function () {\r\n        controllerScope.changeVaccine();\r\n    });\r\n};\r\n\r\nangular.module(\"MyApp\", [\"FilterM\",\"ToolM\"])\r\n        //.directive('watchChange', function() {\r\n        //    return {\r\n        //        scope: {\r\n        //            onchange: '&watchChange'\r\n        //        },\r\n        //        link: function(scope, element, attrs) {\r\n        //            element.on('input', function() {\r\n        //                scope.onchange();\r\n        //            });\r\n        //        }\r\n        //    };\r\n        //})\r\n         .controller(\"MyController\", [\"$scope\",\"ToolProvider\", \"$http\", function ($scope,TPM, $http) {\r\n\r\n             $scope.VM = {};\r\n             $scope.VM.locationObj = {};\r\n             $scope.VM.locationObj.text = \"\";\r\n             $scope.VM.locationObj.id =  0;\r\n             $scope.VM.VaccineSelect = [];\r\n             $scope.VM.selectCheck = \"0\";\r\n             $scope.TM = [];\r\n             $scope.TM.tbData1 = [];\r\n             $scope.TM.tbData2 = [];\r\n             \r\n             $scope.changeVaccine = function () {\r\n                 var postData = {};\r\n                 //postData[\"i\"] = $scope.VM.locationObj.id;\r\n                 postData[\"i\"] = window.getOrgID();\r\n\r\n                 $http({\r\n                     method: 'POST',\r\n                     url: \"/Vaccination/ParameterM/BatchSetting_VaccineOP.aspx\",\r\n                     data: $.param(postData),\r\n                     headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                 })\r\n                 .success(function (data, status, headers, config) {\r\n                                     data.list1 = data.list1 || [];\r\n                                     if (data.list1.length > 0) {\r\n                                          $scope.VM.VaccineSelect = data.list1;\r\n                                          $scope.VM.selectCheck = data.list1[0].I;\r\n                                          $(\"#dv\").show();\r\n                                     }\r\n                                      else {\r\n                                          $scope.VM.VaccineSelect = [];\r\n                                          $scope.VM.selectCheck = \"0\";\r\n                                          $scope.TM.tbData1 = [];\r\n                                          $(\"#dv\").hide();\r\n                                     }\r\n                                  \r\n                                     $scope.TM.tbData1 = [];\r\n                                     $scope.TM.tbData2 = [];\r\n                                   \r\n                                     $scope.TM.tbData1 = data.list2;\r\n\r\n                                     angular.forEach($scope.TM.tbData1, function (value, key) {\r\n                                         if(value.DBVID>0)\r\n                                         {\r\n                                             $scope.TM.tbData2.push(value);\r\n                                         }\r\n                                     });\r\n                  })\r\n                  .error(function (data, status, headers, config) {\r\n                  });\r\n             };\r\n\r\n             $scope.changeSelect = function () {\r\n                 $scope.VM.selectCheck = $scope.VM.selectCheck || 0;\r\n                 var postData = {};\r\n                 postData[\"i\"] = $scope.VM.selectCheck;\r\n\r\n                 $http({\r\n                     method: 'POST',\r\n                     url: \"/Vaccination/ParameterM/BatchSetting_xGetDefaultBatchVaccineOP.aspx\",\r\n                     data: $.param(postData),\r\n                     headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                 })\r\n                 .success(function (data, status, headers, config) {\r\n                     $scope.TM.tbData1 = data;\r\n                 })\r\n                 .error(function (data, status, headers, config) {\r\n                 });\r\n             };\r\n\r\n             $scope.goSetting = function (record) {\r\n                 console.log(record);\r\n                 if (record.DBVID == 0) {\r\n\r\n                     var postData = {};\r\n                     postData[\"b\"] = record.VBID;\r\n                     postData[\"d\"] = record.I;\r\n\r\n                     $http({\r\n                         method: 'POST',\r\n                         url: \"/Vaccination/ParameterM/BatchSetting_AddOP.aspx\",\r\n                         data: $.param(postData),\r\n                         headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                     })\r\n                    .success(function (data, status, headers, config) {\r\n                        data.chk = data.chk || 0;\r\n                        if (data.chk > 0) {\r\n                            record.DBVID = data.chk;\r\n                            $scope.TM.tbData2.push(record);\r\n                            //alert('儲存成功');\r\n                        }\r\n                        else {\r\n                            alert('儲存失敗');\r\n                        }\r\n                    })\r\n                    .error(function (data, status, headers, config) {\r\n                    });\r\n                 }\r\n                 else\r\n                 {\r\n                     var postData = {};\r\n                     postData[\"d\"] = record.DBVID;\r\n\r\n                     $http({\r\n                         method: 'POST',\r\n                         url: \"/Vaccination/ParameterM/BatchSetting_RemoveOP.aspx\",\r\n                         data: $.param(postData),\r\n                         headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                     })\r\n                    .success(function (data, status, headers, config) {\r\n                        data.chk = data.chk || 0;\r\n                        if (data.chk > 0) {\r\n                            angular.forEach($scope.TM.tbData2, function (value, key) {\r\n                                if (value.DBVID == record.DBVID) {// && value.I==record.I) {\r\n                                    $scope.TM.tbData2.splice(key, 1);\r\n                                }\r\n                            });\r\n                            record.DBVID = 0;\r\n                            //alert('儲存成功');\r\n                        }\r\n                        else {\r\n                            alert('儲存失敗');\r\n                        }\r\n                    })\r\n                    .error(function (data, status, headers, config) {\r\n                    });\r\n                 }\r\n             };\r\n\r\n             //$scope.openOrgs = function (record) {\r\n             //    TPM.popUpWindow(\"/SelectSingleOrg.aspx\", \"SelectSingleOrg\", 620, 450);\r\n             //};\r\n\r\n             $scope.goRemove = function (record) {\r\n\r\n                     var postData = {};\r\n                     postData[\"d\"] = record.DBVID;\r\n\r\n                     $http({\r\n                         method: 'POST',\r\n                         url: \"/Vaccination/ParameterM/BatchSetting_RemoveOP.aspx\",\r\n                         data: $.param(postData),\r\n                         headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                     })\r\n                    .success(function (data, status, headers, config) {\r\n                        data.chk = data.chk || 0;\r\n                        if (data.chk > 0) {\r\n                            angular.forEach($scope.TM.tbData2, function (value, key) {\r\n                                if (value.DBVID == record.DBVID) {// && value.I==record.I) {\r\n                                    $scope.TM.tbData2.splice(key, 1);\r\n                                }\r\n                            });\r\n                            record.DBVID = 0;\r\n                            //alert('儲存成功');\r\n                        }\r\n                        else {\r\n                            alert('儲存失敗');\r\n                        }\r\n                    })\r\n                    .error(function (data, status, headers, config) {\r\n                    });\r\n\r\n             };\r\n}]);\r\n\r\n//var getCode = function (code) {\r\n//    var element = document.querySelector('#tbLocation');\r\n//    element.value = code.text;\r\n//    element.focus();\r\n//    var controllerElement = document.querySelector('section');\r\n//    var controllerScope = angular.element(controllerElement).scope();\r\n//    controllerScope.$apply(function () {\r\n//        controllerScope.VM.locationObj = code;\r\n//        controllerScope.changeVaccine();\r\n//    });\r\n//};\r\n"]}