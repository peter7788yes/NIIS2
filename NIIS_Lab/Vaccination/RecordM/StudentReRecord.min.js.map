{"version":3,"sources":["StudentReRecord.src.js"],"names":["$","document","on","e","location","href","preventDefault","angular","module","controller","$scope","PageProvider","TPM","hotkeys","PM","TM","VM","locationObj","text","id","title","sAry","concat","selectSchool","changePage","pageIndex","noHistory","show","pgData","genPageData","postData","window","getOrgID","getOrgName","val","replace","prop","filterPageData","data","message","$apply","history","pushState","undefined","hash","length","split","replaceState","add","combo","description","allowIn","callback","event","hotkey","focusType","activeElement","type","goDetail","record","save","obj","doPOST","querySelector","pgNow","setData","JSON","stringify","doReset","hide","reset","setOrgID","defaultOrgID","setOrgName","defaultOrgName","getData","OrgID","OrgName","tbDateStart","tbDateEnd","sy"],"mappings":"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","file":"StudentReRecord.min.js","sourcesContent":["$(function () {\r\n    $(document).on(\"click\", \"#addBtn\", function (e) {\r\n        //if (history.pushState) {\r\n        //    history.pushState(null, document.title, location.href.split(\"?\")[0] + \"?b=1\");\r\n        //}\r\n        location.href = \"/Vaccination/RecordM/StudentReRecord_Add.aspx\";\r\n        e.preventDefault();\r\n        return false;\r\n    });\r\n\r\n\r\n    $(document).on(\"click\", \"#uploadBtn\", function (e) {\r\n        location.href = \"/Vaccination/RecordM/StudentReRecord_Upload.aspx\";\r\n        e.preventDefault();\r\n        return false;\r\n    });\r\n\r\n    //window.addEventListener(\"popstate\", function () {\r\n    //    var currentState = history.state;\r\n    //    if (currentState != null) {\r\n    //        var controllerElement = document.querySelector('section');\r\n    //        var controllerScope = angular.element(controllerElement).scope();\r\n    //        controllerScope.$apply(function () {\r\n    //            controllerScope.changePage(currentState.pageIndex, 1);\r\n    //        });\r\n    //    }\r\n    //});\r\n\r\n    //if (location.search.length > 0) {\r\n    //    setTimeout(function () {\r\n    //        history.go(-1);\r\n    //    }, 10);\r\n    //}\r\n});\r\n\r\nangular.module(\"MyApp\", [\"PageM\", \"FilterM\",\"ToolM\", \"cfp.hotkeys\"])\r\n         .controller(\"MyController\", [\"$scope\", \"PageProvider\", 'ToolProvider', 'hotkeys', function ($scope, PageProvider,TPM, hotkeys) {\r\n\r\n             $scope.PM = PageProvider;\r\n             $scope.TM = {};\r\n             $scope.VM = {};\r\n             $scope.VM.locationObj = {};\r\n             $scope.VM.locationObj.text = \"\";\r\n             $scope.VM.locationObj.id = 0;\r\n             $scope.VM.title = \"\";\r\n\r\n             $scope.VM.sAry = [].concat(sAry);\r\n             $scope.VM.selectSchool = \"\";\r\n\r\n             //$(\"#tmBlock\").show();\r\n             //$scope.PM.changePage(\"\", tbData, function (data) {\r\n             //    $scope.TM.data = data.message;\r\n             //    history.replaceState({ \"pageIndex\": 1 }, document.title, location.href);\r\n             //});\r\n\r\n             $scope.changePage = function (pageIndex, noHistory) {\r\n                 $(\"#tmBlock\").show();\r\n                 var pgData = $scope.PM.genPageData(pageIndex);\r\n                 var postData = {};\r\n                 postData[\"s\"] = \"\";\r\n                 postData[\"e\"] = \"\";\r\n                 //postData.LID = $scope.VM.locationObj.id;\r\n                 postData[\"lid\"] = window.getOrgID();\r\n                 if (window.getOrgName() == \"\") {\r\n                     postData[\"oid\"] = 0;\r\n                 }\r\n                 postData[\"s\"] = $(\"#tbDateStart\").val().replace(/年/g, \"\");\r\n                 postData[\"e\"] = $(\"#tbDateEnd\").val().replace(/年/g, \"\");\r\n                 postData[\"ei\"] = $scope.VM.selectSchool;\r\n                 postData[\"sy\"] = 0;\r\n                 if ($(\"#L1\").prop(\"checked\") == true)\r\n                     postData[\"sy\"] = 1\r\n                 else if ($(\"#L2\").prop(\"checked\") == true)\r\n                     postData[\"sy\"] = 2;\r\n\r\n                 postData = $scope.PM.filterPageData(pgData, postData);\r\n                 $scope.PM.changePage(\"/Vaccination/RecordM/StudentReRecordOP.aspx\", postData, function (data) {\r\n                     $scope.TM.data = data.message;\r\n                     $scope.$apply(function () { });\r\n\r\n                     if (history.pushState && noHistory == undefined) {\r\n                         if (pageIndex > 1 || location.hash.length > 0) {\r\n                             history.pushState({ \"pageIndex\": pageIndex }, document.title, location.href.split(\"?\")[0] + \"?#h\");\r\n                         }\r\n                         else {\r\n                             history.replaceState({ \"pageIndex\": 1 }, document.title, location.href);\r\n                         }\r\n                     }\r\n                 });\r\n             };\r\n\r\n\r\n             hotkeys.add({\r\n                 combo: 'enter',\r\n                 description: 'Description goes here',\r\n                 allowIn: ['INPUT', \"BUTTON\", 'SELECT', 'TEXTAREA'],\r\n                 callback: function (event, hotkey) {\r\n                     var focusType = document.activeElement.type;\r\n                     if (focusType == \"text\" || focusType == \"select-one\") {\r\n                         $scope.changePage(1);\r\n                     }\r\n                 }\r\n             });\r\n\r\n             //$scope.openOrgs = function (record) {\r\n             //    popUpWindow(\"/SelectSingleOrg.aspx\", \"SelectSingleOrg\", 620, 450);\r\n             //};\r\n\r\n             //var popUpWindow = function (url, title, w, h) {\r\n             //    var left = (screen.width / 2) - (w / 2);\r\n             //    var top = (screen.height / 2) - (h / 2);\r\n             //    return window.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);\r\n             //}\r\n\r\n             $scope.goDetail = function (record) {\r\n                 //location.href = \"/Vaccination/RecordM/StudentRecord_Detail.aspx?i=\" + record[\"I\"];\r\n                 //if (history.pushState) {\r\n                 //    history.pushState(null, document.title, location.href.split(\"?\")[0] + \"?b=1\");\r\n                 //}\r\n                 $scope.save();\r\n                 var obj = {};\r\n                 obj['i'] = record[\"I\"];\r\n                 TPM.doPOST(\"/Vaccination/RecordM/StudentReRecord_Detail.aspx\", obj,document.querySelector('#MyForm'));\r\n             };\r\n\r\n             $scope.save = function () {\r\n                 var data = {};\r\n                 data[\"OrgID\"] = window.getOrgID();\r\n                 data[\"OrgName\"] = window.getOrgName();\r\n                 data[\"tbDateStart\"] = $(\"#tbDateStart\").val().replace(/年/g, \"\");\r\n                 data[\"tbDateEnd\"] = $(\"#tbDateEnd\").val().replace(/年/g, \"\");\r\n                 data['pgNow'] = $scope.PM.pgNow;\r\n                 data['selectSchool'] = $scope.VM.selectSchool;\r\n                 data[\"sy\"] = 0;\r\n                 if ($(\"#L1\").prop(\"checked\") == true)\r\n                     data[\"sy\"] = 1\r\n                 else if ($(\"#L2\").prop(\"checked\") == true)\r\n                     data[\"sy\"] = 2;\r\n                 TPM.setData(data);\r\n                 return JSON.stringify(data);\r\n             };\r\n\r\n             $scope.doReset = function () {\r\n                 $(\"#tbDateStart\").val(\"\");\r\n                 $(\"#tbDateEnd\").val(\"\");\r\n                 $(\"#L1\").prop(\"checked\", false);\r\n                 $(\"#L2\").prop(\"checked\", false);\r\n                 $scope.VM.selectSchool = \"\";\r\n                 $(\"#tmBlock\").hide();\r\n                 $scope.PM.reset();\r\n                 window.setOrgID(defaultOrgID);\r\n                 window.setOrgName(defaultOrgName);\r\n             };\r\n\r\n             if (location.hash.length > 0) {\r\n                 var data = TPM.getData();\r\n                 $(\"#ucOrgID\").val(data.OrgID);\r\n                 $(\"#ucOrgName\").val(data.OrgName);\r\n                 $(\"#tbDateStart\").val(data.tbDateStart + \"年\");\r\n                 $(\"#tbDateEnd\").val(data.tbDateEnd + \"年\");\r\n                 $scope.VM.selectSchool.val(data.selectSchool);\r\n            \r\n                 if (data.sy == 1)\r\n                     $(\"#L1\").prop(\"checked\", true);\r\n                 else if (data.sy == 2)\r\n                     $(\"#L2\").prop(\"checked\", true);\r\n                 $scope.changePage(data.pgNow);\r\n             }\r\n             else {\r\n                 $scope.doReset();\r\n             }\r\n}]);\r\n\r\n//var getCode = function (code) {\r\n//    var element = document.querySelector('#tbLocation');\r\n//    element.value = code.text;\r\n//    element.focus();\r\n//    var controllerElement = document.querySelector('section');\r\n//    var controllerScope = angular.element(controllerElement).scope();\r\n//    controllerScope.$apply(function () {\r\n//        controllerScope.VM.locationObj = code;\r\n//        controllerScope.changeVaccine();\r\n//    });\r\n//};"]}