/*! NIIS 2016-04-13 */

angular.module("MyApp",["TreeM"]).controller("MyController",["$scope","$http",function(a,b){a.VM={},a.VM.selectedItemParent="",a.VM.selectedItem={selectedItem:0},a.VM.dataItem={I:0,AC:"",N:"",EN:"",SN:"",OL:0,AS:0,ON:0},a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}],a.getIpPart=function(){0==a.VM.dataItem.IP.length?a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}]:angular.forEach(a.VM.dataItem.IP,function(a,b){a.IS=a.IS||"0.0.0.0",a.IE=a.IE||"0.0.0.0";var c=a.IS.split("."),d=a.IE.split(".");a.i1=parseInt(c[0]),a.i2=parseInt(c[1]),a.i3=parseInt(c[2]),a.i4=parseInt(c[3]),a.i5=parseInt(d[0]),a.i6=parseInt(d[1]),a.i7=parseInt(d[2]),a.i8=parseInt(d[3]),a.IS=a.i1+"."+a.i2+"."+a.i3+"."+a.i4,a.IE=a.i5+"."+a.i6+"."+a.i7+"."+a.i8})},a.getIpString=function(){0==a.VM.dataItem.IP.length?a.VM.dataItem.IP=[{IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0}]:angular.forEach(a.VM.dataItem.IP,function(a,b){a.i1=a.i1||0,a.i2=a.i2||0,a.i3=a.i3||0,a.i4=a.i4||0,a.i5=a.i5||0,a.i6=a.i6||0,a.i7=a.i7||0,a.i8=a.i8||0,a.IS=a.i1+"."+a.i2+"."+a.i3+"."+a.i4,a.IE=a.i5+"."+a.i6+"."+a.i7+"."+a.i8})};var c=sessionStorage.getItem("OrgManagementOrigin");if(c==data){var d=sessionStorage.getItem("OrgManagement");a.VM.tree=JSON.parse(d)}else{var e={},f=[];$.each(JSON.parse(data),function(a,b){b.children=b.children||[],0==b.P?(f.push(b),e=b):null!=e&&(e.I==b.P?e.children.push(b):GenMenuRecursive(b,e))}),a.VM.tree=f,sessionStorage.setItem("OrgManagementOrigin",data),sessionStorage.setItem("OrgManagement",JSON.stringify(f))}a.getDetail=function(c){var d={};d.i=c.I,b({method:"POST",url:"/System/OrgM/OrgManagementOP.aspx",data:$.param(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){a.VM.dataItem=b,a.getIpPart()}).error(function(a,b,c,d){})},a.goSave=function(){if(a.VM.dataItem.I>0){var c={};c.i=a.VM.dataItem.I,c.ac=a.VM.dataItem.AC,c.n=a.VM.dataItem.N,c.en=a.VM.dataItem.EN,c.sn=a.VM.dataItem.SN,c.ol=a.VM.dataItem.OL,c.as=a.VM.dataItem.AS,c.on=a.VM.dataItem.ON,a.getIpString();var d=[];$.each(a.VM.dataItem.IP,function(a,b){var c=_.pick(b,["IS","IE"]);d.push(c)}),c.ips=encodeURIComponent(JSON.stringify(d)),b({method:"POST",url:"/System/OrgM/OrgManagement_UpdateOP.aspx",data:$.param(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){if(b.chk>0){GetParentRecursive(a.VM.dataItem.I),node.O=a.VM.dataItem.N,node.sort=a.VM.dataItem.ON;a.VM.selectedItem.P>0&&(GetParentRecursive(a.VM.selectedItem.P),node.children=_.sortBy(node.children,["sort","I"])),alert("儲存成功")}else alert("儲存失敗")}).error(function(a,b,c,d){})}else alert("請選擇組織單位")},a.VM.itemClicked=function(b){b.heightLight=!0,a.VM.selectedItem=b,a.getDetail(b),a.VM.selectedItemParent="",GetParentRecursive(b.P),a.VM.selectedItemParent=nodeName},a.VM.itemCheckedChanged=function(a){},a.addIP=function(){a.VM.dataItem.IP.push({IS:"0.0.0.0",IE:"0.0.0.0",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0})},a.cutIP=function(b){a.VM.dataItem.IP.splice(b,1)}}]);var node={},nodeName="",GetParentRecursive=function(a){nodeName="";var b=document.querySelector("section"),c=angular.element(b).scope();RecursiveObj(c.VM.tree[0],a)},RecursiveObj=function(a,b){a.I==b?(nodeName=a.O,node=a):(a.children=a.children||[],$.each(a.children,function(a,c){RecursiveObj(c,b)}))},GenMenuRecursive=function(a,b){var c;b.children=b.children||[];for(var d=0;d<=b.children.length-1;d++)a.P==b.children[d].I&&(c=b.children[d]);null!=c?(c.children=c.children||[],c.children.push(a)):b.children.forEach(function(b){GenMenuRecursive(a,b)})};
//# sourceMappingURL=OrgManagement.min.js.map