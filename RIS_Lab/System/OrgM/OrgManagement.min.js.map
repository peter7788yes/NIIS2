{"version":3,"sources":["OrgManagement.src.js"],"names":["angular","module","controller","$scope","$http","VM","selectedItemParent","selectedItem","dataItem","I","AC","N","EN","SN","OL","AS","ON","IP","IS","IE","i1","i2","i3","i4","i5","i6","i7","i8","getIpPart","length","forEach","item","index","ISA","split","IEA","parseInt","getIpString","OrgsMenuOrigin","sessionStorage","getItem","data","finalObj","tree","JSON","parse","lastNode","rtn","$","each","children","P","push","GenMenuRecursive","setItem","stringify","getDetail","$item","postData","method","url","param","headers","Content-Type","success","status","config","error","goSave","IPs","obj","_","pick","encodeURIComponent","chk","GetParentRecursive","node","O","sort","sortBy","alert","itemClicked","heightLight","nodeName","itemCheckedChanged","addIP","cutIP","$index","splice","id","controllerElement","document","querySelector","controllerScope","element","scope","RecursiveObj","nowNode","innerNode","myParent","i"],"mappings":"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","file":"OrgManagement.min.js","sourcesContent":["angular.module(\"MyApp\", [\"TreeM\"])\r\n         .controller(\"MyController\", [\"$scope\", \"$http\", function ($scope, $http) {\r\n          $scope.VM = {};\r\n          $scope.VM.selectedItemParent = \"\";\r\n          $scope.VM.selectedItem = { selectedItem :0};\r\n          $scope.VM.dataItem = { I: 0, AC: \"\", N: \"\", EN: \"\", SN: \"\", OL: 0, AS: 0, ON: 0 };\r\n          $scope.VM.dataItem.IP=[{ IS: \"0.0.0.0\", IE: \"0.0.0.0\",i1:0,i2:0,i3:0,i4:0,i5:0,i6:0,i7:0,i8:0 }];\r\n    \r\n          $scope.getIpPart = function () {\r\n\r\n              if ($scope.VM.dataItem.IP.length == 0) {\r\n                  $scope.VM.dataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n              }\r\n              else {\r\n                  angular.forEach($scope.VM.dataItem.IP, function (item, index) {\r\n                      item.IS = item.IS || \"0.0.0.0\";\r\n                      item.IE = item.IE || \"0.0.0.0\";\r\n\r\n                      var ISA = item.IS.split('.');\r\n                      var IEA = item.IE.split('.');\r\n\r\n                      item.i1 = parseInt(ISA[0]);\r\n                      item.i2 = parseInt(ISA[1]);\r\n                      item.i3 = parseInt(ISA[2]);\r\n                      item.i4 = parseInt(ISA[3]);\r\n\r\n                      item.i5 = parseInt(IEA[0]);\r\n                      item.i6 = parseInt(IEA[1]);\r\n                      item.i7 = parseInt(IEA[2]);\r\n                      item.i8 = parseInt(IEA[3]);\r\n\r\n                      item.IS = item.i1 + '.' + item.i2 + '.' + item.i3 + '.' + item.i4;\r\n                      item.IE = item.i5 + '.' + item.i6 + '.' + item.i7 + '.' + item.i8;\r\n\r\n                  });\r\n              }\r\n          };\r\n\r\n          $scope.getIpString = function () {\r\n              if ($scope.VM.dataItem.IP.length == 0) {\r\n                  $scope.VM.dataItem.IP = [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n              }\r\n              else {\r\n                  angular.forEach($scope.VM.dataItem.IP, function (item, index) {\r\n\r\n                      item.i1 = item.i1 || 0;\r\n                      item.i2 = item.i2 || 0;\r\n                      item.i3 = item.i3 || 0;\r\n                      item.i4 = item.i4 || 0;\r\n                      item.i5 = item.i5 || 0;\r\n                      item.i6 = item.i6 || 0;\r\n                      item.i7 = item.i7 || 0;\r\n                      item.i8 = item.i8 || 0;\r\n\r\n                      item.IS = item.i1 + '.' + item.i2 + '.' + item.i3 + '.' + item.i4;\r\n                      item.IE = item.i5 + '.' + item.i6 + '.' + item.i7 + '.' + item.i8;\r\n                  });\r\n              }\r\n          };\r\n\r\n          var OrgsMenuOrigin = sessionStorage.getItem(\"OrgManagementOrigin\");\r\n          if (OrgsMenuOrigin == data) {\r\n              var finalObj = sessionStorage.getItem(\"OrgManagement\");\r\n              $scope.VM.tree = JSON.parse(finalObj);\r\n          }\r\n          else {\r\n              var lastNode = {};\r\n              var rtn = [];\r\n\r\n              $.each(JSON.parse(data), function (index, item) {\r\n                  item.children = item.children || [];\r\n                  if (item.P == 0) {\r\n                      rtn.push(item);\r\n                      lastNode = item;\r\n                  }\r\n                  else {\r\n                      if (lastNode != null) {\r\n                          if (lastNode.I == item.P) {\r\n                              lastNode.children.push(item);\r\n                          }\r\n                          else {\r\n                              GenMenuRecursive(item, lastNode);\r\n                          }\r\n                      }\r\n                  }\r\n              });\r\n              $scope.VM.tree = rtn;\r\n\r\n              sessionStorage.setItem(\"OrgManagementOrigin\", data);\r\n              sessionStorage.setItem(\"OrgManagement\", JSON.stringify(rtn));\r\n          }\r\n\r\n          $scope.getDetail = function ($item) {\r\n              var postData = {};\r\n              postData[\"i\"] = $item.I;\r\n\r\n              $http({\r\n                  method: 'POST',\r\n                  url: \"/System/OrgM/OrgManagementOP.aspx\",\r\n                  data: $.param(postData),\r\n                  headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n              })\r\n             .success(function (data, status, headers, config) {\r\n                 //console.log(JSON.stringify(data));\r\n                 $scope.VM.dataItem = data;\r\n                 //$scope.VM.dataItem.IP = data.IP || [{ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 }];\r\n                 //console.log($scope.VM.dataItem.IP);\r\n                 $scope.getIpPart();\r\n              })\r\n              .error(function (data, status, headers, config) {\r\n              });\r\n          };\r\n\r\n          $scope.goSave = function () {\r\n              if($scope.VM.dataItem.I>0)\r\n              {\r\n                  var postData = {};\r\n                  postData[\"i\"] = $scope.VM.dataItem.I;\r\n                  postData[\"ac\"] = $scope.VM.dataItem.AC;\r\n                  postData[\"n\"] = $scope.VM.dataItem.N;\r\n                  postData[\"en\"] = $scope.VM.dataItem.EN;\r\n                  postData[\"sn\"] = $scope.VM.dataItem.SN;\r\n                  postData[\"ol\"] = $scope.VM.dataItem.OL;\r\n                  postData[\"as\"] = $scope.VM.dataItem.AS;\r\n                  postData[\"on\"] = $scope.VM.dataItem.ON;\r\n\r\n                  $scope.getIpString();\r\n                  var IPs = [];\r\n                  $.each($scope.VM.dataItem.IP, function (index, item) {\r\n                      var obj = _.pick(item, ['IS', \"IE\"]);\r\n                      IPs.push(obj);\r\n                      //console.log(IPs);\r\n                  });\r\n                  postData[\"ips\"] = encodeURIComponent(JSON.stringify(IPs));\r\n\r\n                  $http({\r\n                      method: 'POST',\r\n                      url: \"/System/OrgM/OrgManagement_UpdateOP.aspx\",\r\n                      data: $.param(postData),\r\n                      headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\r\n                  })\r\n                 .success(function (data, status, headers, config) {\r\n                     if (data.chk > 0) {\r\n                         GetParentRecursive($scope.VM.dataItem.I);\r\n                         node.O = $scope.VM.dataItem.N;\r\n                         //console.log($scope.VM.dataItem.ON)\r\n                         node.sort = $scope.VM.dataItem.ON;\r\n                         var myitem = {};\r\n                         var IDAry =[];\r\n                         if ($scope.VM.selectedItem.P > 0) {\r\n\r\n                             GetParentRecursive($scope.VM.selectedItem.P);\r\n                             node.children = _.sortBy(node.children, [\"sort\", \"I\"]);\r\n\r\n                             //var rootTree=$scope.VM.tree;\r\n                             //var hasFound = false;\r\n                             //while (hasFound == false) {\r\n                             //    $.each(rootTree, function (index, item) {\r\n                             //        if (item.I == $scope.VM.selectedItem.P) {\r\n                             //            hasFound = true;\r\n                             //            item.children = _.sortBy(item.children, [\"sort\", \"I\"]);\r\n                             //            //console.log(item.children);\r\n                             //        }\r\n                             //    });\r\n\r\n                             //    if(hasFound == false)\r\n                             //    {\r\n                             //        rootTree\r\n                             //    }\r\n                             //}\r\n                             //myitem = _.filter($scope.VM.tree, function (item) {\r\n                             //    if (item.I == $scope.VM.selectedItem.P)\r\n                             //        return item;\r\n                             //});\r\n                             //_.forEach($scope.VM.tree, function (value, key) {\r\n                             //    console.log(key);\r\n                             //});\r\n                         }\r\n                         alert('儲存成功');\r\n                     }\r\n                     else {\r\n                         alert('儲存失敗');\r\n                     }\r\n                 })\r\n                  .error(function (data, status, headers, config) {\r\n                  });\r\n              }\r\n              else\r\n              {\r\n                  alert(\"請選擇組織單位\");\r\n              }\r\n          };\r\n\r\n          $scope.VM.itemClicked = function ($item) {\r\n              $item.heightLight=true;\r\n              $scope.VM.selectedItem = $item;\r\n              $scope.getDetail($item);\r\n              $scope.VM.selectedItemParent = \"\";\r\n              GetParentRecursive($item.P);\r\n              $scope.VM.selectedItemParent = nodeName;\r\n\r\n          };\r\n\r\n          $scope.VM.itemCheckedChanged = function ($item) {\r\n          };\r\n\r\n          $scope.addIP = function () {\r\n              $scope.VM.dataItem.IP.push({ IS: \"0.0.0.0\", IE: \"0.0.0.0\", i1: 0, i2: 0, i3: 0, i4: 0, i5: 0, i6: 0, i7: 0, i8: 0 });\r\n              //$(\".icon_no\").show();\r\n          };\r\n\r\n          $scope.cutIP = function ($index) {\r\n              $scope.VM.dataItem.IP.splice($index, 1);\r\n              //_.pullAt($scope.VM.dataItem.IP, $index);\r\n              //if ($scope.VM.dataItem.IP.length == 1)\r\n              //{\r\n              //    $(\".icon_no\").hide();\r\n              //}\r\n          };\r\n}]);\r\n\r\nvar node = {};\r\nvar nodeName = \"\";\r\nvar GetParentRecursive = function (id) {\r\n    nodeName = \"\";\r\n    var controllerElement = document.querySelector('section');\r\n    var controllerScope = angular.element(controllerElement).scope();\r\n    RecursiveObj(controllerScope.VM.tree[0], id);\r\n};\r\n\r\nvar RecursiveObj = function (obj, id) {\r\n    \r\n    if (obj.I == id) {\r\n        nodeName = obj.O;\r\n        node = obj;\r\n    }\r\n    else {\r\n        obj.children = obj.children || [];\r\n        $.each(obj.children, function (index, item) {\r\n            RecursiveObj(item, id);\r\n        });\r\n    }\r\n}\r\n\r\nvar GenMenuRecursive = function (nowNode, innerNode) {\r\n    var myParent;\r\n    innerNode.children = innerNode.children || [];\r\n\r\n    for (var i = 0; i <= innerNode.children.length - 1 ; i++) {\r\n        if (nowNode.P == innerNode.children[i].I) {\r\n            myParent = innerNode.children[i];\r\n        }\r\n    }\r\n\r\n    if (myParent != null) {\r\n        myParent.children = myParent.children || [];\r\n        myParent.children.push(nowNode);\r\n    }\r\n    else {\r\n        innerNode.children.forEach(function (item) {\r\n            GenMenuRecursive(nowNode, item);\r\n        });\r\n    }\r\n}\r\n"]}